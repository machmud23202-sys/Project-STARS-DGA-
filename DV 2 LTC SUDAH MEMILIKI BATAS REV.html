<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DGA Check | THE DUVAL TRIANGLE 2 LTC</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>
  body { font-family: 'Segoe UI', sans-serif; background-color: #f5f7fb; margin: 0; padding: 0; }
  header { background-color: #003399; color: white; padding: 15px 40px; font-size: 20px; font-weight: bold; }
  .main { display:flex; justify-content:space-between; margin:20px auto; width:90%; background:white; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:20px;}
  .input-section { width:30%; }
  .chart-section { width:65%; }
  label { font-weight:600; display:block; margin-top:10px; }
  input { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px; }
  button { background-color:#003399; color:white; border:none; padding:10px 15px; border-radius:5px; margin-top:15px; font-weight:bold; cursor:pointer;}
  button:hover { background-color:#001f66; }
  .hasil { margin-top:15px; background-color:#eef2ff; border-left:5px solid #003399; padding:15px; border-radius:5px; font-size:15px; line-height:1.6; }
  .hasil b { color:#001f66; }
  h2 { color:#003399; font-size:18px; border-bottom:2px solid #003399; padding-bottom:5px; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th { background-color:#003399; color:white; padding:12px; text-align:center; }
  td { border:1px solid #ddd; padding:8px; text-align:center; }
  .action-buttons { margin-top:15px; text-align:right; }
  .btn-excel { background-color:#003399; margin-right:10px; color:white; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
  .btn-delete { background-color:#c62828; color:white; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
  footer { background-color:#003399; color:white; text-align:center; padding:10px; margin-top:40px; }
  .toast { position:fixed; bottom:25px; right:25px; background-color:#003399; color:white; padding:10px 16px; border-radius:6px; opacity:0; transition:opacity 0.4s ease; pointer-events:none; font-size:14px; }
  .toast.show { opacity:1; pointer-events:auto; }

  /* ===========================
      CSS HELP POPUP DITEMPEL DI SINI
     =========================== */
  .help-btn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #1976d2;
    color: #fff;
    font-size: 22px;
    border: none;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    z-index: 999;
  }

  .help-popup {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
  }

  .help-content {
    background: #fff;
    width: 60%;
    max-width: 650px;
    margin: 3% auto;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    animation: fadeIn 0.3s ease;
  }

  .close-help {
    float: right;
    font-size: 28px;
    cursor: pointer;
    color: #666;
  }

  .close-help:hover {
    color: #000;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

</head>
<body>

<header>DGA Check | THE DUVAL TRIANGLE 2 LTC</header>
<a href="Halaman ke 2.html"
     style="text-decoration:none; background-color:#003399; color:white; padding:8px 14px; border-radius:6px; position:absolute; right:40px; top:12px; font-size:15px; transition:background-color 0.2s;">
     ‚¨Ö Kembali
  </a>
</header>

<div class="main">
  <div class="input-section">
  <h2>Analisis Duval Triangle 2 LTC</h2>

  <label for="lokasiTrafo">Lokasi / UP :</label>
<input id="lokasiTrafo" type="text" placeholder="contoh: UP Paiton" />

<label for="ch4">CH‚ÇÑ (Methane):</label>
    <input id="ch4" type="number" placeholder="contoh: 20" />

    <label for="c2h4">C‚ÇÇH‚ÇÑ (Ethylene):</label>
    <input id="c2h4" type="number" placeholder="contoh: 30" />

    <label for="c2h2">C‚ÇÇH‚ÇÇ (Acetylene):</label>
    <input id="c2h2" type="number" placeholder="contoh: 10" />

    

  <!-- Tombol sejajar -->
    <div class="button-row">
      <button onclick="hitungDanPlot()">Hitung & Simpan</button>
      <input type="file" id="excelFile" accept=".xlsx, .xls" class="btn-import">
    </div>

    <!-- Hasil analisis -->
    <div class="hasil" id="hasilText">Hasil analisis akan muncul di sini.</div>
  </div>

  <!-- Grafik di sisi kanan -->
  <div class="chart-section">
    <div id="duvalPlot" style="width:100%; height:500px;"></div>
  </div>
</div>


<div class5="container" style="width:90%; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1);">
  <h2>Riwayat Analisis</h2>
  <table id="hasilTable">
    <thead>

      <tr>
      <th>No</th>
      <th>Lokasi</th>
      <th>Tanggal</th>
      <th>CH‚ÇÑ</th>
      <th>C‚ÇÇH‚ÇÑ</th>
      <th>C‚ÇÇH‚ÇÇ</th>
      <th>Fault</th>
      <th>Rekomendasi</th>


      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="action-buttons">
  <button class="btn-excel" onclick="downloadExcel()">üì• Unduh Excel</button>
  <button class="btn-delete" onclick="hapusSemua()">üóëÔ∏è Hapus Semua</button>
</div>

</div>

<footer>¬© 2025 DGA Check | PLN Nusantara Power</footer>

<div class="toast" id="toast">Data disimpan ke Excel</div>
<button id="helpBtn" class="help-btn">?</button>

<div id="helpPopup" class="help-popup">
  <div class="help-content">
    <span id="closeHelp" class="close-help">&times;</span>
    <h2>Duval Triangle 2 LTC - Help / Info</h2>

    <p><b>Duval Triangle 2</b> digunakan untuk LTC tipe konvensional (compartment-type) di mana operasi normalnya
      terutama melibatkan pemutusan busur listrik (arc breaking) di dalam minyak.</p>

    <p>Beberapa LTC tipe resistif (misalnya UZBs) dapat memiliki zona operasi normal di area X3.</p>

    <p>Untuk LTC konvensional tipe vacuum bottle yang tidak menghasilkan percikan (sparking) pada selector di dalam minyak
      pendingin, gunakan <b>Duval Triangle 1</b>.</p>

    <p>Untuk LTC tipe in-tank (contoh: Reinhausen), di mana sebagian besar arus mengalir melalui transition resistor dan
      menyebabkan pemanasan resistor, zona operasi normalnya dapat berada di bagian segitiga yang berbeda (misalnya T3
      atau T2). Versi baru dari Duval Triangle 2 (Triangle 2a, 2b, dan 2c) sedang disiapkan untuk jenis LTC tersebut.</p>

    <h3>Catatan:</h3>
    <p>Pemilik LTC disarankan menentukan zona operasi normal unit secara lebih spesifik karena biasanya ukuran zona
      aktual lebih kecil daripada zona standar. Operasi di luar zona normal dapat mengindikasikan potensi gangguan atau
      kerusakan.</p>

  </div>
</div>


<!-- ===================================
      JAVASCRIPT POPUP
==================================== -->
<script>
  
  const helpBtn = document.getElementById("helpBtn");
  const helpPopup = document.getElementById("helpPopup");
  const closeHelp = document.getElementById("closeHelp");

  helpBtn.onclick = () => helpPopup.style.display = "block";
  closeHelp.onclick = () => helpPopup.style.display = "none";
  window.onclick = (e) => {
    if (e.target === helpPopup) helpPopup.style.display = "none";
  };
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
  plotDuval(0, 0, 0, null);
});

const STORAGE_KEY = "riwayat_duval5_biotemp";
let hasilData = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
updateTable();

// === DEFINISI ZONA (REGION) ===

  const regions = [
  { 
    name: 'N', 
    color: "rgba(0,150,50,0.45)", 
    alpha: 0.45, 
    coords: [[19,75,6],[19,58,23],[2,75,23],[2,92,6],[19,75,6]]
  
  },
  { 
    name: 'D1', 
    color: "rgba(255,153,0,0.45)", 
    alpha: 0.45, 
    coords: [
      [-1,100,-1],
      [19,81,0],
      [19,75,6],
      [2,92,6],
      [2,75,23],
      [-1,77,23],
      [-1,100,-1]
    ] 
  },

  { 
    name: 'X1', 
    color: "rgba(255,204,0,0.45)", 
    alpha: 0.45, 
    coords: [
      [19,81,-1],
      [100,-1,-1],
      [77,-1,23],
      [19,58,23],
      [19,81,-1]
    ]
  },

  { 
    name: 'T2', 
    color: "rgba(51,153,255,0.45)", 
    alpha: 0.45, 
    coords: [
      [77,-1,23],
      [50,0,50],
      [35,15,50],
      [62,15,23],
     
    ]
  },

  { 
    name: 'T3', 
    color: "rgba(0,51,153,0.45)", 
    alpha: 0.45, 
    coords: [
      [50,0,50],
      [35,15,50],
      [0,15,85],
      [-1,-1,100],
      [50,0,50]
    ]
  },

  { 
    name: 'X3', 
    color: "rgba(255,51,51,0.45)", 
    alpha: 0.45, 
    coords: [
      [0,77,23],
      [62,15,23],
      [0,15,85],
      [0,77,23]
    ]
  }
];



// === KONVERSI TERNARY ‚Üí KOORDINAT 2D ===
function ternaryToXY(a, b, c) {
  const s = a + b + c;
  if (s === 0) return { x: 0, y: 0 };
  const an = a / s, bn = b / s, cn = c / s;
  const sqrt3over2 = Math.sqrt(3) / 2;
  return { x: 1 - (0.5 * an + cn), y: an * sqrt3over2 };
}

// === CEK TITIK DALAM POLYGON ===
function pointInPolygon2D(point, polygon) {
  let inside = false;
  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const xi = polygon[i].x, yi = polygon[i].y;
    const xj = polygon[j].x, yj = polygon[j].y;
    const intersect = ((yi > point.y) !== (yj > point.y)) &&
      (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }
  return inside;
}

// === DETEKSI ZONA ===
function detectRegionForPoint(a, b, c) {
  const pt = ternaryToXY(a, b, c);
  for (let r of regions) {
    const poly = r.coords.map(p => ternaryToXY(p[0], p[2], p[1]));
    if (pointInPolygon2D(pt, poly)) return r;
  }
  return null;
}

// === FUNGSI UTAMA HITUNG & PLOT ===
function hitungDanPlot() {
  const ch4 = parseFloat(document.getElementById("ch4").value);
  const c2h4 = parseFloat(document.getElementById("c2h4").value);
  const c2h2 = parseFloat(document.getElementById("c2h2").value);
  const lokasi = document.getElementById("lokasiTrafo").value || "-";
  
  if (isNaN(ch4) || isNaN(c2h4) || isNaN(c2h2) || (ch4 + c2h4 + c2h2) === 0) {
    alert("Isi semua nilai gas dengan benar!");
    return;
  }

  const total = ch4 + c2h4 + c2h2;
  const pCH4 = (ch4 / total) * 100;
  const pC2H4 = (c2h4 / total) * 100;
  const pC2H2 = (c2h2 / total) * 100;

  // === LOW NORMAL (posisi yang benar) ===
  if (ch4 < 25 && c2h4 < 20 && c2h2 < 2) {

    const hasilLow = "Low Normal";
    const rekomLow = [
      "Peralatan dalam kondisi normal.",
      "Lakukan monitoring rutin sesuai jadwal (tahunan / semester).",
      "Tidak diperlukan tindakan korektif khusus."
    ];

    document.getElementById("hasilText").innerHTML =
      `<b>Hasil:</b> ${hasilLow}<br><b>Rekomendasi:</b><ol>${rekomLow.map(r => `<li>${r}</li>`).join('')}</ol>
       <div style='margin-top:8px;color:#333;'>%CH‚ÇÑ=${pCH4.toFixed(1)} | %C‚ÇÇH‚ÇÑ=${pC2H4.toFixed(1)} | %C‚ÇÇH‚ÇÇ=${pC2H2.toFixed(1)}</div>`;

    hasilData.push({
      tanggal: new Date().toLocaleString(),
      lokasi,
      ch4,
      c2h4,
      c2h2,
      fault: hasilLow,
      rekom: rekomLow.join("; ")
    });

    saveToStorage();
    updateTable();

    // üí• HAPUS PLOT (tidak menampilkan segitiga)
    Plotly.purge("duvalPlot");

    return; // STOP ‚Äî tidak masuk duval
  }

  // === PROSES NORMAL DUVAL ===
  const found = detectRegionForPoint(pCH4, pC2H4, pC2H2);
  const fault = found ? found.name : "Tidak terklasifikasi";
  const info = rekomendasiMap[fault];

  document.getElementById("hasilText").innerHTML = info
    ? `<b>Hasil:</b> ${info.hasil}<br><b>Rekomendasi:</b><ol>${info.rekom.map(r=>`<li>${r}</li>`).join('')}</ol>
       <div style='margin-top:8px;color:#333;'>%CH‚ÇÑ=${pCH4.toFixed(1)} | %C‚ÇÇH‚ÇÑ=${pC2H4.toFixed(1)} | %C‚ÇÇH‚ÇÇ=${pC2H2.toFixed(1)}</div>`
    : `<b>Hasil:</b> ${fault}`;

  hasilData.push({
    tanggal: new Date().toLocaleString(),
    lokasi,
    ch4,
    c2h4,
    c2h2,
    fault,
    rekom: info ? info.rekom.join("; ") : "-"
  });

  saveToStorage();
  updateTable();
  plotDuval(pCH4, pC2H4, pC2H2, found);
}


// === PLOT SEGITIGA DUVAL ===
function plotDuval(aVal = 0, bVal = 0, cVal = 100, foundRegion = null) {
  // --- Gambar setiap zona (region) ---
  const traces = regions.map(r => ({
    type: 'scatterternary',
    mode: 'lines',
    fill: 'toself',
    fillcolor: r.color,
    line: { color: 'black', width: 1 },
    name: r.name,
    a: r.coords.map(p => p[0]), 
    b: r.coords.map(p => p[1]), // FIX jangan di ubah
    c: r.coords.map(p => p[2])  
  }));

  // --- Titik hasil (point) ---
  const point = {
    type: 'scatterternary',
    mode: 'markers',
    a: [aVal],
    b: [cVal], 
    c: [bVal], 
      
    marker: {
      color: foundRegion ? foundRegion.color : 'black',
      size: 14,
      line: { color: '#222', width: 1 }
    },
    name: 'Hasil'
  };

  // --- Layout segitiga (mirror) ---
  const layout = {
    ternary: {
      sum: 100,
      aaxis: { title: '', ticksuffix: '', dtick: 10 },
      baxis: { title: '', ticksuffix: '', dtick: 10 },
      caxis: { title: '', ticksuffix: '', dtick: 10 }
    },
    annotations: [
      { text: "% CH‚ÇÑ ‚Üí", x: 0.22, y: 0.5, textangle: -60, showarrow: false, font: { size: 14, color: '#003399' } },
      { text:" % C‚ÇÇH‚ÇÑ ‚Üí" , x: 0.78, y: 0.5, textangle: 60, showarrow: false, font: { size: 14, color: '#003399' } },
      { text: "‚Üê % C‚ÇÇH‚ÇÇ", x: 0.5, y: -0.15, textangle: 0, showarrow: false, font: { size: 14, color: '#003399' } }
    ],
    title: 'DUVAL TRIANGLE 2 LTC',
    height: 500,
    showlegend: true,
    legend: { orientation: 'h', x: 0.1, y: -0.12 }
  };

  Plotly.react('duvalPlot', [point, ...traces], layout)

}

// === REKOMENDASI SETIAP FAULT ===
 const rekomendasiMap = {
  
  "X1": {
    hasil: "X1 = Overheating ringan (<300¬∞C)",
    rekom: [
      "Tingkatkan frekuensi pengambilan sampel DGA (bulanan-triwulan).",
      "Lakukan inspeksi visual OLTC bila masuk jadwal pemeliharaan.",
      "Periksa kondisi kontak dan resistansi kontak."
    ]
  },

  "X3": {
    hasil: "X3 = Coking in Progress / Abnormal Arcing ",
    rekom: [
      "Lakukan monitoring DGA lebih sering (mingguan-bulanan).",
      "Periksa OLTC, terutama diverter switch, selector, dan mekanisme gerak.",
      "Jika tren gas meningkat cepat, lakukan inspeksi lebih cepat."
    ]
  },

  "T2": {
    hasil: "T2 = Severe Coking (300-700¬∞C)",
    rekom: [
      "Tingkatkan frekuensi sampling DGA ke mingguan-bulanan.",
      "Lakukan inspeksi internal OLTC sesegera mungkin.",
      "Pertimbangkan pengurangan beban dan lakukan uji tambahan (termografi/elektrikal)."
    ]
  },

  "T3": {
    hasil: "T3 = Severe Coking Berat (>700¬∞C)",
    rekom: [
      "Kondisi ALARM: lakukan tindakan segera.",
      "Segera lakukan inspeksi internal OLTC dan pemeriksaan kontak (diverter)." ,
      "Pertimbangkan shutdown terjadwal untuk perbaikan atau penggantian komponen."
    ]
  },

  "D1": {
    hasil: "D1 = Abnormal Arcing (Low-Energy Discharge)",
    rekom: [
      "Tingkatkan frekuensi sampling DGA ke mingguan.",
      "Lakukan pemeriksaan OLTC terutama pada kontak arcing dan carbon deposit.",
      "Periksa mekanisme OLTC untuk memastikan tidak ada misalignment atau keausan."
    ]
  },
};

// === UPDATE TABEL ===
function updateTable(){
  const tbody = document.querySelector("#hasilTable tbody");

  tbody.innerHTML = hasilData.length
    ? hasilData.map((d,i)=>{
        const rekomList = d.rekom && d.rekom !== "-"
          ? d.rekom.split(";").map((r,idx)=>`<div>${idx+1}. ${r.trim()}</div>`).join("")
          : "-";

        return `
        <tr>
          <td>${i+1}</td>
          <td>${d.lokasi || ""}</td>
          <td>${d.tanggal}</td>
          <td>${d.ch4}</td>
          <td>${d.c2h4}</td>
          <td>${d.c2h2}</td>
          <td>${d.fault}</td>
          <td>${rekomList}</td>
        </tr>`;
      }).join("")
    : '<tr><td colspan="8" style="color:#888;">Belum ada data</td></tr>';
}



// === HAPUS SEMUA DATA ===
function hapusSemua(){
  if(confirm("Hapus semua riwayat analisis?")){
    hasilData=[];localStorage.removeItem(STORAGE_KEY);updateTable();
  }
}
/* =======================
   Table & storage tambahan
   ======================= */
function saveToStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(hasilData));
}

/* =======================
   Excel import (SheetJS)
   ======================= */
document.getElementById('excelFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const rows = XLSX.utils.sheet_to_json(sheet, { defval: 0 });

    rows.forEach(row => {

      const lokasi = row["Nama UP-Trafo"] || row["Lokasi"] || "-";

      const ch4  = Number(row.CH4  || 0);
      const c2h4 = Number(row.C2H4 || 0);
      const c2h2 = Number(row.C2H2 || 0);

      if ((ch4 + c2h4 + c2h2) === 0) return;

      /* =========================================
   BATAS LOW NORMAL (TIDAK DIPLOT DI SEGITIGA)
   ========================================= */
if (ch4 < 25 && c2h4 < 20 && c2h2 < 2) {

  const rekomLowNormal = [
    "Peralatan dalam kondisi normal.",
    "Lakukan monitoring rutin sesuai jadwal (tahunan / semester).",
    "Tidak diperlukan tindakan korektif khusus."
  ];

  hasilData.push({
    tanggal: row.Tanggal || new Date().toLocaleString(),
    lokasi,
    ch4, c2h4, c2h2,
    fault: "NORMAL",
    rekom: rekomLowNormal.join("; ")   // ‚Üê masuk ke kolom rekom
  });

  return; // STOP, tidak diplot
}

      const total = ch4 + c2h4 + c2h2;
      const pCH4  = (ch4  / total) * 100;
      const pC2H4 = (c2h4 / total) * 100;
      const pC2H2 = (c2h2 / total) * 100;

      const found = detectRegionForPoint(pCH4, pC2H4, pC2H2);
      const fault = found ? found.name : "Tidak terklasifikasi";
      const info  = rekomendasiMap[fault];

      hasilData.push({
        tanggal: row.Tanggal || new Date().toLocaleString(),
        lokasi,
        ch4, c2h4, c2h2,
        fault,
        rekom: info ? info.rekom.join("; ") : "-"
      });

    });

    saveToStorage();
    updateTable();

    /* ============================
       RE-PLOT SEMUA TITIK VALID
       ============================ */
    Plotly.purge('duvalPlot');

    // Titik valid (bukan LOW NORMAL)
    const traces = hasilData
      .filter(d => d.fault !== "NORMAL")
      .map((d, i) => {
        const total = d.ch4 + d.c2h4 + d.c2h2;
        if (total === 0) return null;

        const pCH4  = (d.ch4  / total) * 100;
        const pC2H4 = (d.c2h4 / total) * 100;
        const pC2H2 = (d.c2h2 / total) * 100;

        return {
          type: 'scatterternary',
          mode: 'markers+text',
          a: [pCH4],
          b: [pC2H2],
          c: [pC2H4],
          marker: {
            size: 10,
            color: 'black',
            symbol: 'circle',
            line: { color: 'white', width: 1 }
          },
          text: [`S${i + 1}`],
          textposition: 'top center',
          showlegend: false 
        };
      }).filter(Boolean);

    // Warna area region Duval
    const areaTraces = regions.map(r => ({
      type: 'scatterternary',
      mode: 'lines',
      fill: 'toself',
      fillcolor: r.color,
      line: { color: 'black', width: 1 },
      name: r.name,
      a: r.coords.map(p => p[0]),
      b: r.coords.map(p => p[1]),
      c: r.coords.map(p => p[2])
    }));

    /* ==================================
       === PLOTLY YANG KAMU MINTA ===
       ================================== */
    Plotly.react('duvalPlot', [...areaTraces, ...traces], {
      ternary: {
        sum: 100,
        aaxis: { title: '', ticksuffix: '', dtick: 10 },
        baxis: { title: '', ticksuffix: '', dtick: 10 },
        caxis: { title: '', ticksuffix: '', dtick: 10 }
      },

      annotations: [
        { text: "% CH‚ÇÑ ‚Üí",  x: 0.22, y: 0.5,  textangle: -60, showarrow: false, font: { size: 14, color: '#003399' } },
        { text:" % C‚ÇÇH‚ÇÑ ‚Üí", x: 0.78, y: 0.5,  textangle: 60,  showarrow: false, font: { size: 14, color: '#003399' } },
        { text: "‚Üê % C‚ÇÇH‚ÇÇ", x: 0.5,  y: -0.15,textangle: 0,   showarrow: false, font: { size: 14, color: '#003399' } }
      ],

      title: 'DUVAL TRIANGLE 2 LTC',
      height: 500
    });

    showToast("Import Excel selesai ‚Äî titik hitam ditampilkan");
    e.target.value = "";
  };

  reader.readAsArrayBuffer(file);
});

// === EXPORT CSV ===
function downloadExcel(){
  let csv="No,Tanggal,CH4,C2H4,C2H2,Fault,Rekomendasi\n";
  hasilData.forEach((d,i)=>{
    const r=(d.rekom||"").replace(/,/g,';');
    csv+=`${i+1},${d.tanggal},${d.ch4},${d.c2h4},${d.c2h2},"${d.fault}","${r}"\n`;
  });
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="Riwayat Duval Triangle 2 LTC.csv";
  a.click();
  showToast();
}

function showToast(msg="Data disimpan ke Excel"){
  const t=document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

</script>
</body>
</html>
