<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DGA Check | THE DUVAL TRIANGLE 5 FOR THERMAL FAULTS AND FAULTS IN PAPER IN MINERAL OILS</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
  <style>
  body { font-family: 'Segoe UI', sans-serif; background-color: #f5f7fb; margin: 0; padding: 0; }
  header { background-color: #003399; color: white; padding: 15px 40px; font-size: 20px; font-weight: bold; }
  .main { display:flex; justify-content:space-between; margin:20px auto; width:90%; background:white; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); padding:20px;}
  .input-section { width:30%; }
  .chart-section { width:65%; }
  label { font-weight:600; display:block; margin-top:10px; }
  input { width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px; }
  button { background-color:#003399; color:white; border:none; padding:10px 15px; border-radius:5px; margin-top:15px; font-weight:bold; cursor:pointer;}
  button:hover { background-color:#001f66; }
  .hasil { margin-top:15px; background-color:#eef2ff; border-left:5px solid #003399; padding:15px; border-radius:5px; font-size:15px; line-height:1.6; }
  .hasil b { color:#001f66; }
  h2 { color:#003399; font-size:18px; border-bottom:2px solid #003399; padding-bottom:5px; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th { background-color:#003399; color:white; padding:12px; text-align:center; }
  td { border:1px solid #ddd; padding:8px; text-align:center; }
  .action-buttons { margin-top:15px; text-align:right; }
  .btn-excel { background-color:#003399; margin-right:10px; color:white; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
  .btn-delete { background-color:#c62828; color:white; padding:8px 12px; border-radius:6px; border:none; cursor:pointer; }
  footer { background-color:#003399; color:white; text-align:center; padding:10px; margin-top:40px; }
  .toast { position:fixed; bottom:25px; right:25px; background-color:#003399; color:white; padding:10px 16px; border-radius:6px; opacity:0; transition:opacity 0.4s ease; pointer-events:none; font-size:14px; }
  .toast.show { opacity:1; pointer-events:auto; }

  /* ===========================
      CSS HELP POPUP DITEMPEL DI SINI
     =========================== */
  .help-btn {
    position: fixed;
    bottom: 25px;
    right: 25px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #1976d2;
    color: #fff;
    font-size: 22px;
    border: none;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    z-index: 999;
  }

  .help-popup {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(3px);
  }

  .help-content {
    background: #fff;
    width: 60%;
    max-width: 650px;
    margin: 3% auto;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    animation: fadeIn 0.3s ease;
  }

  .close-help {
    float: right;
    font-size: 28px;
    cursor: pointer;
    color: #666;
  }

  .close-help:hover {
    color: #000;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }
</style>

</head>
<body>

<header>DGA Check | THE DUVAL TRIANGLE 5 FOR THERMAL FAULTS AND FAULTS IN PAPER IN MINERAL OILS</header>
<a href="Halaman ke 2.html"
     style="text-decoration:none; background-color:#003399; color:white; padding:8px 14px; border-radius:6px; position:absolute; right:40px; top:12px; font-size:15px; transition:background-color 0.2s;">
     ‚¨Ö Kembali
  </a>
</header>

<div class="main">
  <div class="input-section">
  <h2>Analisis Duval Triangle 5 For Thermal And Fault in Paper in Mineral Oils</h2>

  <label for="lokasiTrafo">Lokasi / UP :</label>
  <input id="lokasiTrafo" type="text" placeholder="contoh: UP Paiton" />

  <label for="ch4">CH‚ÇÑ (Metana):</label>
  <input type="number" id="ch4" placeholder="contoh: 30">

  <label for="c2h4">C‚ÇÇH‚ÇÑ (Etena):</label>
  <input type="number" id="c2h4" placeholder="contoh: 20">

  <label for="c2h6">C‚ÇÇH‚ÇÜ (Etana):</label>
  <input type="number" id="c2h6" placeholder="contoh: 10">

    

  <!-- Tombol sejajar -->
    <div class="button-row">
      <button onclick="hitungDanPlot()">Hitung & Simpan</button>
      <input type="file" id="excelFile" accept=".xlsx, .xls" class="btn-import">
    </div>

    <!-- Hasil analisis -->
    <div class="hasil" id="hasilText">Hasil analisis akan muncul di sini.</div>
  </div>

  <!-- Grafik di sisi kanan -->
  <div class="chart-section">
    <div id="duvalPlot" style="width:100%; height:500px;"></div>
  </div>
</div>


<div class="container" style="width:90%; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1);">
  <h2>Riwayat Analisis</h2>
  <table id="hasilTable">
    <thead>

<tr>
  <th>No</th>
  <th>Lokasi</th>
  <th>Tanggal</th>
  <th>CH‚ÇÑ</th>
  <th>C‚ÇÇH‚ÇÑ</th>
  <th>C‚ÇÇH‚ÇÜ</th>
  <th>Fault</th>
  <th>Rekomendasi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="action-buttons">
  <button class="btn-excel" onclick="downloadExcel()">üì• Unduh Excel</button>
  <button class="btn-delete" onclick="hapusSemua()">üóëÔ∏è Hapus Semua</button>
</div>

</div>

<footer>¬© 2025 DGA Check | PLN Nusantara Power</footer>

<div class="toast" id="toast">Data disimpan ke Excel</div>
<button id="helpBtn" class="help-btn">?</button>

<div id="helpPopup" class="help-popup">
  <div class="help-content">
    <span id="closeHelp" class="close-help">&times;</span>
    <h2>Duval Triangle 5 LTF Mineral Oils ‚Äì Help / Info</h2>

    <p><b>Duval Triangle 5</b> untuk gangguan termal pada minyak mineral menggunakan gas 
      <b>CH‚ÇÑ, C‚ÇÇH‚ÇÑ, dan C‚ÇÇH‚ÇÜ</b>.</p>

    <p><b>Duval Triangle 5</b> digunakan untuk memperoleh informasi tambahan mengenai
      gangguan yang telah diidentifikasi sebagai gangguan termal 
      (<b>T2 atau T3</b>) menggunakan <b>Duval Triangle 1</b> 
      yang memakai gas CH‚ÇÑ, C‚ÇÇH‚ÇÑ, dan C‚ÇÇH‚ÇÇ.</p>

    <p><b>Jangan menggunakan Duval Triangle 5</b> untuk gangguan jenis 
      <b>D1</b> dan <b>D2</b>.</p>

    <p>Jika hasil analisis <b>Triangle 5</b> dan <b>Triangle 4</b> tidak sesuai, 
      hal ini kemungkinan menunjukkan adanya <b>campuran gangguan</b> 
      (mixture of faults).</p>

    <p>Gangguan yang muncul pada <b>zona C</b> memiliki kemungkinan sekitar 
      <b>80%</b> melibatkan <b>karbonisasi kertas</b> (bukan 100%).</p>
  </div>
</div>

<!-- ===================================
      JAVASCRIPT POPUP
==================================== -->
<script>
  
  const helpBtn = document.getElementById("helpBtn");
  const helpPopup = document.getElementById("helpPopup");
  const closeHelp = document.getElementById("closeHelp");

  helpBtn.onclick = () => helpPopup.style.display = "block";
  closeHelp.onclick = () => helpPopup.style.display = "none";
  window.onclick = (e) => {
    if (e.target === helpPopup) helpPopup.style.display = "none";
  };
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
  plotDuval(0, 0, 0, null);
});

const STORAGE_KEY = "riwayat Duval Triangle 5 For Thermal And Fault in Paper in Mineral Oils";
let hasilData = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
updateTable();

// === KOORDINAT AREA DUVAL 4 ===
const regions = [ 
  { 
    name: 'S', 
    color: 'rgba(255,0,0,0.55)', 
    coords: [
      [85,100,0],
      [47,70,13],
      [81,17,11],
      [100,18,0]
    ] 
  },
  { 
    name: 'O', 
    color: 'rgba(255, 165, 0, 0.55)', 
    coords: [
      [0,100,0],
      [100,0,0],
      [98,0,11],
      [0,81,9]
    ] 
  },

  { 
    name: 'C', 
    color: 'rgba(255,255,0,0.55)', 
    coords: [
      [0,19,45],
      [59,30,10],
      [95,15,12.5],
      [45,14.5,57],
      [43,16.5,58],
      [19,17.5,85]
    ] 
  },

  { 
    name: 'T2', 
    color: 'rgba(75,192,192,0.55)', 
    coords: [
      [95,15,12.5],
      [98,0,11],
      [80,0,43],
      [69,16,45]
    ] 
  },

  { 
    name: 'T3', 
    color: 'rgba(0,255,0,0.55)', 
    coords: [
      [0,0,100],
      [80,0,43],
      [69,16,45],
      [45,14.5,57],
      [43,16.5,58],
      [19,17.5,85],
      [0,19,45],
      [35,30,35],
      [0,84,45],
      [0,19,45]
    ] 
  },

  { 
    name: 'N/D', 
    color: 'rgba(153,102,255,0.55)', 
    coords: [
      [0,81,9],
      [0,84,45],
      [35,30,35],
      [59,30,10]
    ] 
  },

  { 
    name: 'PD', 
    color: 'rgba(201,203,207,0.55)', 
    coords: [
      [100,18,0],
      [93.2,17,1],
      [100,2.5,1],
      [100,2.5,0]
    ] 
  }
];

// === KONVERSI TERNARY ‚Üí KOORDINAT 2D ===
function ternaryToXY(a, b, c) {
  const s = a + b + c;
  if (s === 0) return { x: 0, y: 0 };
  const an = a / s, bn = b / s, cn = c / s;
  const sqrt3over2 = Math.sqrt(3) / 2;
  return { x: 1 - (0.5 * an + cn), y: an * sqrt3over2 };
}

// === CEK TITIK DALAM POLYGON ===
function pointInPolygon2D(point, polygon) {
  let inside = false;
  for (let i = 0, j = polygon.length - 1; i < polygon.length; j = i++) {
    const xi = polygon[i].x, yi = polygon[i].y;
    const xj = polygon[j].x, yj = polygon[j].y;
    const intersect = ((yi > point.y) !== (yj > point.y)) &&
      (point.x < (xj - xi) * (point.y - yi) / (yj - yi) + xi);
    if (intersect) inside = !inside;
  }
  return inside;
}

// === DETEKSI ZONA ===
function detectRegionForPoint(a, b, c) {
  const pt = ternaryToXY(a, b, c);
  for (let r of regions) {
    const poly = r.coords.map(p => ternaryToXY(p[0], p[2], p[1]));
    if (pointInPolygon2D(pt, poly)) return r;
  }
  return null;
}

// === FUNGSI UTAMA HITUNG & PLOT ===
function hitungDanPlot() {
  const ch4 = parseFloat(document.getElementById("ch4").value);
  const c2h4 = parseFloat(document.getElementById("c2h4").value);
  const c2h6 = parseFloat(document.getElementById("c2h6").value);
  const lokasi = document.getElementById("lokasiTrafo").value || "-";
  
  if (isNaN(ch4) || isNaN(c2h4) || isNaN(c2h6) || (ch4 + c2h4 + c2h6) === 0) {
    alert("Isi semua nilai gas dengan benar!");
    return;
  }

  const total = ch4 + c2h4 + c2h6;
  const pCH4   = (ch4   / total) * 100;
  const pC2H4  = (c2h4  / total) * 100;
  const pC2H6 = (c2h6 / total) * 100;

  // === LOW NORMAL BARU ===
  if (ch4 < 20 && c2h4 < 25 && c2h6 < 15) {

    const hasilLow = "Normal";
    const rekomLow = [
      "Peralatan dalam kondisi normal.",
      "Lakukan monitoring rutin sesuai jadwal (tahunan / semester).",
      "Tidak diperlukan tindakan korektif khusus."
    ];

    document.getElementById("hasilText").innerHTML =
      `<b>Hasil:</b> ${hasilLow}<br><b>Rekomendasi:</b><ol>${rekomLow.map(r => `<li>${r}</li>`).join('')}</ol>
       <div style='margin-top:8px;color:#333;'>%CH‚ÇÑ=${pCH4.toFixed(1)} | %C‚ÇÇH‚ÇÑ=${pC2H4.toFixed(1)} | %C‚ÇÇH‚ÇÜ=${pC2H6.toFixed(1)}</div>`;

    hasilData.push({
      tanggal: new Date().toLocaleString(),
      lokasi,
      ch4,
      c2h4,
      c2h6,
      fault: hasilLow,
      rekom: rekomLow.join("; ")
    });

    saveToStorage();
    updateTable();

    // ‚ùó Jangan tampilkan plot
    Plotly.purge("duvalPlot");

    return;
  }

  // === DETEKSI ZONA DENGAN SENYAWA BARU ===
  const found = detectRegionForPoint(pCH4, pC2H4, pC2H6);
  const fault = found ? found.name : "Tidak terklasifikasi";
  const info = rekomendasiMap[fault];

  document.getElementById("hasilText").innerHTML = info
    ? `<b>Hasil:</b> ${info.hasil}<br><b>Rekomendasi:</b><ol>${info.rekom.map(r=>`<li>${r}</li>`).join('')}</ol>
       <div style='margin-top:8px;color:#333;'>%CH‚ÇÑ=${pCH4.toFixed(1)} | %CH‚ÇÑ=${pC2H4.toFixed(1)} | %C‚ÇÇH‚ÇÜ=${pC2H6.toFixed(1)}</div>`
    : `<b>Hasil:</b> ${fault}`;

  hasilData.push({
    tanggal: new Date().toLocaleString(),
    lokasi,
    ch4,
    c2h4,
    c2h6,
    fault,
    rekom: info ? info.rekom.join("; ") : "-"
  });

  saveToStorage();
  updateTable();
  
  
  plotDuval(pCH4, pC2H4, pC2H6, found);
}

// === PLOT SEGITIGA DUVAL ===
function plotDuval(aVal = 0, bVal = 0, cVal = 100, foundRegion = null) {

  const traces = regions.map(r => ({
    type: 'scatterternary',
    mode: 'lines',
    fill: 'toself',
    fillcolor: r.color,
    line: { color: 'black', width: 1 },
    name: r.name,
    a: r.coords.map(p => p[0]),
    b: r.coords.map(p => p[1]),
    c: r.coords.map(p => p[2])
  }));

  const point = {
    type: 'scatterternary',
    mode: 'markers',
    a: [aVal], 
    b: [cVal], 
    c: [bVal],
    marker: {
      color: foundRegion ? foundRegion.color : 'black',
      size: 14,
      line: { color: '#222', width: 1 }
    },
    name: 'Hasil'
  };

  const layout = {
    ternary: {
      sum: 100,
      aaxis: { title: '', ticksuffix: '', dtick: 10 },
      baxis: { title: '', ticksuffix: '', dtick: 10 },
      caxis: { title: '', ticksuffix: '', dtick: 10 }
    },
    annotations: [
      { text: "% CH‚ÇÑ ‚Üí", x: 0.22, y: 0.5, textangle: -60, showarrow: false, font: { size: 14, color: '#003399' } },
      { text: "% C‚ÇÇH‚ÇÑ ‚Üí", x: 0.78, y: 0.5, textangle: 60,  showarrow: false, font: { size: 14, color: '#003399' } },
      { text: "‚Üê % C‚ÇÇH‚ÇÜ", x: 0.5, y: -0.15, showarrow: false, font: { size: 14, color: '#003399' } }
    ],
    title: 'DUVAL TRIANGLE (CH‚ÇÑ / C‚ÇÇH‚ÇÑ / C‚ÇÇH‚ÇÜ)',
    height: 500,
    showlegend: true,
    legend: { orientation: 'h', x: 0.1, y: -0.12 }
  };

  Plotly.react('duvalPlot', [point, ...traces], layout);
}


// === REKOMENDASI SETIAP FAULT ===
const rekomendasiMap = {
  "T2" : { hasil :"Thermal Fault 2 (T2)", rekom: ["Lakukan furan test untuk menilai degradasi kertas isolasi.", "Kurangi beban operasional transformator.", "Rencanakan outage untuk pemeriksaan internal jika hasil furan menunjukkan penuaan lanjut."] },
  "T3": { hasil: "Thermal Fault 3 (T3)", rekom: ["Segera lakukan evaluasi kondisi internal transformator","Jadwalkan shutdown terkontrol untuk pemeriksaan menyeluruh.","Lakukan penggantian winding atau isolasi yang rusak."] }, 
  "PD": { hasil: "Partial Discharge (PD)", rekom: ["Lakukan analisis tren gas.", "Uji water content dan BDV.", "Perbaiki pendinginan & lakukan filtrasi oli."] },
  "S": { hasil: "Stray Gassing (S)", rekom: ["Pantau tren gas, kondisi masih aman.", "Periksa suhu operasi minyak."] },
  "C": { hasil: "Corona (C)", rekom: ["Lakukan furan test & evaluasi selulosa.", "Rencanakan outage & inspeksi internal winding.", "Ganti isolasi terdegradasi."] },
  "O": { hasil: "Overheating (O)", rekom: ["Lakukan thermography untuk area panas.", "Periksa oil flow & radiator."] },
  "N/D": { hasil: "Tidak teridentifikasi  (N/D)", rekom: ["Tingkatkan frekuensi sampling", "Lakukan pengujian pelengkap (furan, tan Œ¥, moisture).", "Bandingkan dengan baseline DGA sebelumnya."] }
};
// === UPDATE TABEL ===
function updateTable() {
  const tbody = document.querySelector("#hasilTable tbody");

  tbody.innerHTML = hasilData.length
    ? hasilData.map((d, i) => {
        const rekomList = d.rekom && d.rekom !== "-"
          ? d.rekom.split(";").map((r, idx) => `<div>${idx + 1}. ${r.trim()}</div>`).join("")
          : "-";

        return `
        <tr>
          <td>${i + 1}</td>
          <td>${d.lokasi || ""}</td>
          <td>${d.tanggal}</td>
          <td>${d.ch4}</td>
          <td>${d.c2h4}</td>
          <td>${d.c2h6}</td>
          <td>${d.fault}</td>
          <td>${rekomList}</td>
        </tr>`;
      }).join("")
    : '<tr><td colspan="8" style="color:#888;">Belum ada data</td></tr>';
}




// === HAPUS SEMUA DATA ===
function hapusSemua(){
  if(confirm("Hapus semua riwayat analisis?")){
    hasilData=[];localStorage.removeItem(STORAGE_KEY);updateTable();
  }
}
/* =======================
   Table & storage tambahan
   ======================= */
function saveToStorage() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(hasilData));
}

/* =======================
   Excel import (SheetJS)
======================= */
document.getElementById('excelFile').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(evt) {
    const data = new Uint8Array(evt.target.result);
    const workbook = XLSX.read(data, { type: 'array' });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const rows = XLSX.utils.sheet_to_json(sheet, { defval: 0 });

    rows.forEach(row => {

      // 1) Ambil Lokasi
      const lokasi =
        row["Nama UP-Trafo"] ||
        row["Lokasi"]        ||
        row["lokasi"]        ||
        "-";

      // 2) Ambil nilai gas
      const ch4  = Number(row.CH4  ?? row.ch4  ?? row["CH‚ÇÑ"]  ?? 0);
      const c2h4 = Number(row.C2H4 ?? row.c2h4 ?? row["C‚ÇÇH‚ÇÑ"] ?? 0);
      const c2h6 = Number(row.C2H6 ?? row.c2h6 ?? row["C‚ÇÇH‚ÇÜ"] ?? 0);

      // Jika nol semua ‚Üí skip
      if ((ch4 + c2h4 + c2h6) === 0) return;

      // 3) Hitung persen
      const total = ch4 + c2h4 + c2h6;
      const pCH4  = (ch4  / total) * 100;
      const pC2H4 = (c2h4 / total) * 100;
      const pC2H6 = (c2h6 / total) * 100;

      // === LOW NORMAL (IMPORT EXCEL) ===
      if (ch4 < 20 && c2h4 < 25 && c2h6 < 15) {

        const hasilLow = "Normal";
        const rekomLow = [
          "Peralatan dalam kondisi normal.",
          "Lakukan monitoring rutin sesuai jadwal (tahunan / semester).",
          "Tidak diperlukan tindakan korektif khusus."
        ];

        hasilData.push({
          tanggal: row.Tanggal || new Date().toLocaleString(),
          lokasi,
          ch4,
          c2h4,
          c2h6,
          fault: hasilLow,
          rekom: rekomLow.join("; ")
        });

        return;   // ‚ùó STOP ‚Äî jangan lanjut ke deteksi Duval
      }

      // === DETEKSI ZONA DUVAL ===
      const found = detectRegionForPoint(pCH4, pC2H4, pC2H6);
      const fault = found ? found.name : "Tidak terklasifikasi";
      const info  = rekomendasiMap[fault];

      // Simpan Data
      hasilData.push({
        tanggal: row.Tanggal || new Date().toLocaleString(),
        lokasi,
        ch4,
        c2h4,
        c2h6,
        fault: info ? info.hasil : fault,
        rekom: info ? info.rekom.join("; ") : "-"
      });

    });

    saveToStorage();
    updateTable();

    // === Tampilkan titik di grafik ===
    if (hasilData.length > 0) {
      Plotly.purge('duvalPlot');

      const traces = hasilData.map((d, i) => {
        const total = d.ch4 + d.c2h4 + d.c2h6;
        if (total === 0) return null;

        const pCH4   = (d.ch4   / total) * 100;
        const pC2H4  = (d.c2h4  / total) * 100;
        const pC2H6 = (d.c2h6 / total) * 100;

        return {
          type: 'scatterternary',
          mode: 'markers+text',
          a: [pCH4],
          b: [pC2H4],
          c: [pC2H6],
          marker: {
            size: 10,
            color: 'black',
            symbol: 'circle',
            line: { color: 'white', width: 1 }
          },
          text: [`S${i + 1}`],
          textposition: 'top center',
          showlegend: false
        };
      }).filter(Boolean);

      const areaTraces = regions.map(r => ({
        type: 'scatterternary',
        mode: 'lines',
        fill: 'toself',
        fillcolor: r.color,
        line: { color: 'black', width: 1 },
        name: r.name,
        a: r.coords.map(p => p[0]),
        b: r.coords.map(p => p[1]),
        c: r.coords.map(p => p[2])
      }));

      Plotly.react(
        'duvalPlot',
        [...areaTraces, ...traces],
        {
          ternary: {
            sum: 100,
            aaxis: { title: '', dtick: 10 },
            baxis: { title: '', dtick: 10 },
            caxis: { title: '', dtick: 10 },
          },
          annotations: [
            { text: "% CH‚ÇÑ ‚Üí", x: 0.22, y: 0.5, textangle: -60, showarrow: false },
            { text: "% C‚ÇÇH‚ÇÑ ‚Üí", x: 0.78, y: 0.5, textangle: 60, showarrow: false },
            { text: "‚Üê % C‚ÇÇH‚ÇÜ", x: 0.5, y: -0.15, textangle: 0, showarrow: false }
          ],
          title: 'Duval Triangle 5 (LTF ‚Äì CH‚ÇÑ / C‚ÇÇH‚ÇÑ / C‚ÇÇH‚ÇÜ)',
          height: 500
        }
      );
    }

    showToast("Import Excel selesai ‚Äî titik ditampilkan");
    e.target.value = "";
  };

  reader.readAsArrayBuffer(file);
});


// === EXPORT CSV ===
function downloadExcel() {

  let csv = "No,Tanggal,CH4,C2H4,C2H6,Fault,Rekomendasi\n";

  hasilData.forEach((d, i) => {
    const r = (d.rekom || "").replace(/,/g, ';');
    csv += `${i+1},${d.tanggal},${d.ch4},${d.c2h4},${d.c2h6},"${d.fault}","${r}"\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "Riwayat_Duval5_LTF_CH4_C2H4_C2H6.csv";
  a.click();

  showToast("CSV berhasil dibuat");
}


function showToast(msg="Data disimpan ke Excel"){
  const t=document.getElementById("toast");
  t.textContent = msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

</script>
</body>
</html>
